services:
  - type: web
    name: ather-crm-chennai
    env: python
    plan: free
    buildCommand: |
      pip install -r requirements.txt
      echo "âœ… Dependencies installed successfully"
      echo "ğŸ” Checking for eventlet: $(pip list | grep eventlet || echo 'No eventlet found')"
      echo "ğŸ” Checking gunicorn version: $(gunicorn --version)"
      echo "ğŸš« Ensuring no eventlet workers are configured"
      echo "ğŸ”§ Current working directory: $(pwd)"
      echo "ğŸ“ Files in current directory: $(ls -la)"
      echo "ğŸ§ª Testing Gunicorn configuration..."
      python test_gunicorn.py
      echo "âœ… Gunicorn configuration test completed"
    startCommand: |
      echo "ğŸš€ Starting with sync workers ONLY..."
      echo "ğŸ”§ Worker class: sync (NOT eventlet)"
      echo "ğŸ‘¥ Workers: 2"
      echo "â±ï¸ Timeout: 120"
      echo "ğŸš« Explicitly disabling eventlet workers"
      echo "ğŸ” Environment variables:"
      echo "   GUNICORN_CMD_ARGS: $GUNICORN_CMD_ARGS"
      echo "   GUNICORN_WORKER_CLASS: $GUNICORN_WORKER_CLASS"
      echo "   GUNICORN_WORKERS: $GUNICORN_WORKERS"
      echo "   GUNICORN_TIMEOUT: $GUNICORN_TIMEOUT"
      echo "ğŸš« FORCING sync workers - no eventlet allowed"
      exec gunicorn --worker-class sync --workers 2 --timeout 120 --bind 0.0.0.0:$PORT --preload app:app
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.9
      - key: RENDER
        value: true
      - key: PRODUCTION
        value: true
      - key: PYTHONHTTPSVERIFY
        value: "0"
      - key: CURL_CA_BUNDLE
        value: ""
      - key: REQUESTS_CA_BUNDLE
        value: ""
      - key: SSL_CERT_FILE
        value: ""
      - key: GUNICORN_CMD_ARGS
        value: "--worker-class sync --workers 2 --timeout 120 --preload"
      - key: GUNICORN_WORKER_CLASS
        value: "sync"
      - key: GUNICORN_WORKERS
        value: "2"
      - key: GUNICORN_TIMEOUT
        value: "120"
      - key: GUNICORN_BIND
        value: "0.0.0.0:8000"


